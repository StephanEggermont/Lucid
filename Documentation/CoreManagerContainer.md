# Lucid - `CoreManagerContainer`

`CoreManagerContainer` is convenience object generated by Lucid which contains one core manager per entity type.

It isn't required to use it, but is recommended as it facilitates the use of managers accross the project and avoids data synchronization problematics.

## Data Synchronization

To understand why this container is useful, it's important to understand certain rules about core managers and data synchronization.

Firstly, core managerss instances aren't synchronized with each other. This means that writing data with one instance of a core manager won't necessarily update the continuous publishers of other instances of the same entity type.

Another aspect to bear in mind is that core managerss have an internal synchronization system in order to avoid overriding fresh data with outdated data. This system isn't shared between instances, but multiple instances may be writing to the same stores. It is **not recommended** to use such a configuration as it can lead to data collisions and damage local stores' integrity.

Generally speaking, it is adviced to use only one instance of core manager per entity type in a project, which is where `CoreManagerContainer` comes handy.

## Initialization

```swift
let client = MyAPIClient(...)
let coreDataManager = CoreDataManager(...)

let coreManagers = CoreManagerContainer(
  cacheLimit: 512,
  client: client,
  coreDataManager: coreDataManager
)

coreManagers.myEntityManager.get(byID: ...)
```

The `CoreManagerContainer` depends on two objects:

1. [`APIClient`](./Client.md): An interface to your network APIs
2. [`CoreDataManager`](./CoreData.md): An interface to the `CoreData` stack.

By default, core managers are using an `InMemoryStore` as a caching system in front of a `CoreDataStore`. That's why it is required to set the `cacheLimit` to a reasonable value as it is the maximum amount of entities the `InMemoryStore` can contain per entity type.

## Default Store Configurations

`CoreManagerContainer` automatically creates the stores which are being injected into the core managers. 

By default, it uses the following:

- `LocalEntity` => `InMemoryStore`
- `CoreDataEntity`=> `InMemoryStore` + `CoreDataStore`
- `RemoteEntity` => `RemoteStore`
- `CoreDataEntity` + `RemoteEntity` => `InMemoryStore` + `CoreDataStore` + `RemoteStore`

## Custom Store Configuration

`CoreManagerContainer` provides a way to use your own configuration of stores for a type of entity. Here's how to do so:

```swift
extension MyEntityType {
  
  static func stores(with client: APIClient,
                     clientQueue: inout APIClientQueue,
                     coreDataManager: CoreDataManager,
                     cacheLimit: Int) -> [Storing<MyEntityType>] { 
    return [...]
  }
}
```
